<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Linux系统启动流程(参考) | 知与行</title><meta name="author" content="QiYan"><meta name="copyright" content="QiYan"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="我们在计算机基础中简单介绍了一下计算机是如何进行启动。下面则是详细的介绍一台Linux操作系统是如何进行相应启动的。本内容目前只是初版，只供参考，后期还需要进行优化。   CentOS 6启动流程 POST--&gt;BIOS(Boot Sequence)--&gt;MBR(bootloader,446)--&gt;Kernel--&gt;initrd--&gt;(ROOTFS)&#x2F;sbin&#x2F;init(&#x2F;etc&#x2F;inittab">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux系统启动流程(参考)">
<meta property="og:url" content="http://example.com/2022/11/29/Linux-start/index.html">
<meta property="og:site_name" content="知与行">
<meta property="og:description" content="我们在计算机基础中简单介绍了一下计算机是如何进行启动。下面则是详细的介绍一台Linux操作系统是如何进行相应启动的。本内容目前只是初版，只供参考，后期还需要进行优化。   CentOS 6启动流程 POST--&gt;BIOS(Boot Sequence)--&gt;MBR(bootloader,446)--&gt;Kernel--&gt;initrd--&gt;(ROOTFS)&#x2F;sbin&#x2F;init(&#x2F;etc&#x2F;inittab">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-11-29T07:45:07.822Z">
<meta property="article:modified_time" content="2022-11-29T07:45:07.821Z">
<meta property="article:author" content="QiYan">
<meta name="twitter:card" content="summary"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2022/11/29/Linux-start/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Linux系统启动流程(参考)',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-29 15:45:07'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/font.css"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="知与行" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">19</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">知与行</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Linux系统启动流程(参考)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-11-29T07:45:07.822Z" title="发表于 2022-11-29 15:45:07">2022-11-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-29T07:45:07.821Z" title="更新于 2022-11-29 15:45:07">2022-11-29</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux/">Linux</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">8.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>41分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Linux系统启动流程(参考)"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><div class="note blue icon-padding flat">
<p>我们在计算机基础中简单介绍了一下计算机是如何进行启动。下面则是详细的介绍一台Linux操作系统是如何进行相应启动的。本内容目前只是初版，只供参考，后期还需要进行优化。</p>
</div>

<h1 id="CentOS-6"><a href="#CentOS-6" class="headerlink" title="CentOS 6"></a>CentOS 6</h1><h2 id="启动流程"><a href="#启动流程" class="headerlink" title="启动流程"></a>启动流程</h2><div class="note orange icon-padding flat">
<p>POST-->BIOS(Boot Sequence)-->MBR(bootloader,446)-->Kernel-->initrd-->(ROOTFS)/sbin/init(/etc/inittab)</p>
</div>

    
<ul>
<li><p>通电：计算机最重要的设备是CPU和内存，CPU从内存中获取指令或数据进行相关操作。但计算机内存是易失性存储，即断电后内存内容将会清空。故计算机中内嵌了一个ROM（存储了BIOS程序），开机后会将ROM中的内容复制到内存中.</p>
</li>
<li><p>BIOS：基本输入输出系统。首先进行硬件检测（POST阶段）、然后按照BIOS中设置的启动设备顺序（通常是硬盘）查找MBR。</p>
</li>
<li><p>MBR：主引导记录。查找硬盘上的活动分区，然后加载该分区的内核（Kernel）和虚根（initrd）。硬盘小于2T使用的是MBR，大于2T使用的是其它格式。</p>
<pre><code>  引导加载程序类型：

      LILO: LInux Loader，分区小于8G时使用

      GRUB: GRand Unified Bootloader
          Stage1: MBR，该阶段位于MBR中的Bootloader区域。目的是跳转到stage1_5或者stage2的第一个扇区上。

          Stage1_5: 识别/boot的文件系统类型，使grub可以从文件系统中读取体积更大功能更复杂的stage2文件。该阶段一般安装在MBR后、第一个分区前的那段空闲空间中。也就是MBR gap空间，它的作用是跳转到stage2的第一个扇区。

          Stage2: /boot/grub/，该阶段是根据配置文件加载内核和虚根文件系统。
      GRUB2：

  GRUB配置文件：
      grub.conf			
      
      default=0  # 设定默认启动的title的编号，从0开始
      timeout=5  # 等待用户选择的超时时长，单位是秒
      splashimage=(hd0,0)/grub/splash.xpm.gz  # grub的背景图片
      hiddenmenu # 隐藏菜单
      password redhat
      password --md5 $1$HKXJ51$B9Z8A.X//XA.AtzU1.KuG.（在开机的GRUB界面修改配置时的密码）
      title Red Hat Enterprise Linux Server (2.6.18-308.el5)  # 内核标题，或操作系统名称，字符串，可自由修改
          root (hd0,0)  # 内核文件所在的设备；对grub而言，所有类型硬盘一律hd，格式为(hd#,N)；hd#, #表示第几个磁盘；最后的N表示对应磁盘的分区；
          kernel /vmlinuz-2.6.18-308.el5 ro root=/dev/vol0/root rhgb quiet   # 内核文件路径，及传递给内核的参数
          initrd /initrd-2.6.18-308.el5.img # ramdisk文件路径
          password --md5 $1$HKXJ51$B9Z8A.X//XA.AtzU1.KuG.（登陆该内核的密码）
      title Install Red Hat Enterprise Linux 5
          root (hd0,0)
          kernel /vmlinuz-5 ks=http://172.16.0.1/workstation.cfg ksdevice=eth0 noipv6
          initrd /initrd-5
          password --md5 $1$FSUEU/$uhUUc8USBK5QAXc.BfW4m.

      注：password密码可以使用grub-md5-crypt生成


        
</code></pre>
</li>
<li><p>Kernel：Linux内核。</p>
<pre><code>  内核设计风格：
      单内核：Linux (LWP)，将操作系统所有功能都做入内核。
          核心库：ko(kernel object)
          共享库：so(share object)
          
      微内核：Windows, Solaris (线程)：内核很小只是一个核心，将文件管理、进程管理
      等功能做成内核的子系统。当需要时内核再加载相关子系统。

  Linux中的内核是单内核加模块化风格。
  
  当Linux内核加载完成后，它需要读取根目录下的/sbin/init进行初始化。但是操作系统读取
  磁盘需要加载相应驱动，要加载驱动也需要读取磁盘。由于不同电脑根分区所在硬盘设备并不
  一致。为了避免将所有硬盘驱动都做到内核中，在开始的时候。在内核和根目录之间先建立一
  个initrd中间层（虚根）。该文件是在安装操作系统的过程中动态生成的。最后，挂载根文件
  系统并再将虚根中的内容复制到根文件系统中。
  
</code></pre>
</li>
<li><p>initrd：虚根（获取内存中的一段空间当作硬盘使用）。和根目录的结构类似。RedHat5中名称: ramdisk–&gt;initrd，RedHat6中名称: ramfs–&gt;initramfs</p>
</li>
<li><p>&#x2F;sbin&#x2F;init: 启动init程序进入初始化阶段。用户空间的主导进程，所有在用户空间的进程都由init进行管理。</p>
<pre><code>  启动的服务不同：
      运行级别：0-6
          0：halt（关机）
          1: single user mode（单用户模式）, 直接以管理员身份切入， s,S,single，忘记管理员密码使用。直接使用管理员用户登录，修改密码。
          2：multi user mode, no NFS（多用户模式，没有网络服务）
          3: multi user mode, text mode（多用户模型，命令行）
          4：reserved（保留）
          5: multi user mode, graphic mode（多用户，图形界面）
          6: reboot（重启）
  查看运行级别：
      runlevel: 
      who -r
  查看内核release号：
      uname -r

  [demo@localhost ~]$ runlevel
  N 5
  注：N代表前一个运行级别（即从那个运行级别切换而来），如果没有则是N。
  [demo@localhost ~]$ who -r
           run-level 5  2022-01-22 02:53
  [demo@localhost ~]$ uname -r
  3.10.0-1062.el7.x86_64
</code></pre>
</li>
</ul>
<p>注：目前电脑中一般将BIOS和MBR的组合升级为了UEFI(相当于BIOS)和GPT（GPT为了兼容，开头也存储了一份MBR。这里也用于存储第一阶段的启动代码，并且这个MBR只有一个标识为0xEE的分区）</p>
<h2 id="grub安装"><a href="#grub安装" class="headerlink" title="grub安装"></a>grub安装</h2><p>安装grub stage1:</p>
<pre><code># grub
grub&gt; root (hd0,0) // 指定boot所在分区
grub&gt; set (hd0) // 在hd0硬盘上安装grub stage1
注：grub2的grub命令只有在开机时才能进入
</code></pre>
<p>安装grub stage2：</p>
<pre><code># grub-install --root-directory=/path/to/boot&#39;s_parent_dir  /PATH/TO/DEVICE
</code></pre>
<p>grub命令：</p>
<pre><code>grub&gt; find 
grub&gt; root (hd#,N)
grub&gt; kernel /PATH/TO/KERNEL_FILE
grub&gt; initrd /PATH/TO/INITRD_FILE
grub&gt; boot
</code></pre>
<p>具体参照：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/walk1314/p/9018919.html">https://www.cnblogs.com/walk1314/p/9018919.html</a></p>
<h2 id="Kernel初始化的过程"><a href="#Kernel初始化的过程" class="headerlink" title="Kernel初始化的过程"></a>Kernel初始化的过程</h2><ul>
<li><p>1、设备探测</p>
</li>
<li><p>2、驱动初始化（可能会从initrd（initramfs）文件中装载驱动模块）</p>
</li>
<li><p>3、以只读挂载根文件系统；</p>
</li>
<li><p>4、装载第一个进程init（PID：1）</p>
<pre><code>  /sbin/init：（/etc/inittab）
      sysvinit：串行：先启动一个服务之后，再启动另一个服务。
      upstart: ubuntu, d-bus, event-driven（红帽6.0：采用基于事件的方式，并行）
      systemd:（并行,红帽7.0）
</code></pre>
</li>
</ul>
<h2 id="sysvinit"><a href="#sysvinit" class="headerlink" title="sysvinit"></a>sysvinit</h2><p>&#x2F;etc&#x2F;inittab配置文件：</p>
<pre><code>/etc/inittab作用:
    1、设定默认运行级别；
    2、运行系统初始化脚本；
    3、运行指定运行级别对应的目录下的脚本；
    4、设定Ctrl+Alt+Del组合键的操作；
    5、定义UPS电源在电源故障/恢复时执行的操作；
    6、启动虚拟终端(2345级别)；
    7、启动图形终端(5级别)；

/etc/inittab格式：
    id:runlevels:action:process
        id: 标识符，不重复即可
        runlevels: 在哪个级别运行此行；
        action: 在什么情况下执行此行；
        process: 要运行程序; 

    action:
        initdefault: 设定默认运行级别
        sysinit: 系统初始化
        wait: 等待级别切换至此级别时执行
        respawn: 一旦程序终止，会重新启动
        
        例：
        id:3:initdefault:
        
        si::sysinit:/etc/rc.d/rc.sysinit	
        l0:0：wait：/etc/rc.d/rc 0


/etc/rc.d/rc.sysinit完成的任务：
    1、激活udev和selinux；
    2、根据/etc/sysctl.conf文件，来设定内核参数；
    3、设定时钟时钟；
    4、装载键盘映射；
    5、启用交换分区；
    6、设置主机名；
    7、根文件系统检测，并以读写方式重新挂载；
    8、激活RAID和LVM设备；
    9、启用磁盘配额；
    10、根据/etc/fstab，检查并挂载其它文件系统；
    11、清理过期的锁和PID文件；

/etc/rc.d/rc # 完成任务：

    for I in /etc/rc#.d/K*; do
      $I stop
    done
        
    for I in /etc/rc#.d/S*; do
      $I start
    done
    
    ##: 关闭或启动的优先次序，数据越小越优先被选定
        先关闭以K开头的服务，后启动以S开头的服务；
</code></pre>
<p>sysvinit服务脚本制作：</p>
<p>&#x2F;etc&#x2F;rc.d&#x2F;init.d&#x2F;服务脚本<br>服务脚本支持配置文件：&#x2F;etc&#x2F;sysconfig&#x2F;服务脚本同名的配置文件</p>
<p>脚本相关规范：  </p>
<ul>
<li><p>脚本位置:&#x2F;etc&#x2F;rc.d&#x2F;init.d   </p>
</li>
<li><p>脚本接受参数：start|stop|restart|status</p>
</li>
<li><p>脚本中的特殊内容：</p>
<pre><code>  # chkconfig: runlevels SS KK  当chkconfig命令来为此脚本在rc#.d目录创建链接时，runlevels表示默认为runlevels级别创建为S*开头的链接，-表示没有级别默认为所有级别创建S*开头的链接；除此之外的级别默认创建为K*开头的链接；S后面的启动优先级为SS所表示的数字；K后面关闭优先次序为KK所表示的数字；
  # description: 用于说明此脚本的简单功能； \, 续行
</code></pre>
</li>
</ul>
<p>样例脚本：</p>
<pre><code>#!/bin/bash
#
# chkconfig: 2345 77 22
# description: Test Service
# 
LOCKFILE=/var/lock/subsys/myservice

status() &#123;
  if [ -e $LOCKFILE ]; then
    echo &quot;Running...&quot;
  else
    echo &quot;Stopped.&quot;
  fi
&#125;

usage() &#123;
  echo &quot;`basename $0` &#123;start|stop|restart|status&#125;&quot;
&#125;

case $1 in
start)
  echo &quot;Starting...&quot; 
  touch $LOCKFILE ;;
stop)
  echo &quot;Stopping...&quot; 
  rm -f $LOCKFILE &amp;&gt; /dev/null
  ;;
restart)
  echo &quot;Restarting...&quot; ;;
status)
  status ;;
*)
  usage ;;
esac
</code></pre>
<p>相关命令：</p>
<pre><code>chkconfig --list： 查看所有独立守护服务的启动设定；独立守护进程！
    chkconfig --list SERVICE_NAME
    
chkconfig --add SERVICE_NAME

chkconfig --del SERVICE_NAME

chkconfig [--level RUNLEVELS] SERVICE_NAME &#123;on|off&#125;
    如果省略级别指定，默认为2345级别；
</code></pre>
<p>&#x2F;etc&#x2F;rc.d&#x2F;rc.local：系统最后启动的一个服务，准确说，执行的最后一个脚本；   </p>
<p>守护进程的类型：</p>
<ul>
<li><p>独立守护进程:可以自定义在哪些级别上启动和关闭</p>
</li>
<li><p>xinetd：超级守护进程，代理人。需要关联至运行级别</p>
<pre><code>  瞬时守护进程：不需要关联至运行级别，当需要时启动。

  超级守护进程使用：
      1. 配置yum源
      
      2. 安装xinetd
      [root@localhost yum.repos.d]# yum install xinetd

      3. 查看xinetd进程
      [root@localhost init.d]# chkconfig --list

      Note: This output shows SysV services only and does not include native
            systemd services. SysV configuration data might be overridden by native
            systemd configuration.
      
            If you want to list systemd services use &#39;systemctl list-unit-files&#39;.
            To see services enabled on particular target use
            &#39;systemctl list-dependencies [target]&#39;.
      
      netconsole     	0:off	1:off	2:off	3:off	4:off	5:off	6:off
      network        	0:off	1:off	2:on	3:on	4:on	5:on	6:off
      
      xinetd based services:
          chargen-dgram: 	off
          chargen-stream:	off
          daytime-dgram: 	off
          daytime-stream:	off
          discard-dgram: 	off
          discard-stream:	off
          echo-dgram:    	off
          echo-stream:   	off
          tcpmux-server: 	off
          time-dgram:    	off
          time-stream:   	off
      
      4.重启xinetd服务
      [root@localhost init.d]# service xinetd restart
      Redirecting to /bin/systemctl restart xinetd.service

      5.重启xinetd下的某个服务
      [root@localhost init.d]# chkconfig echo-dgram on
</code></pre>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/diantong/p/10734202.html#:~:text=CentOS6%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%EF%BC%88%E5%90%AB%E8%AF%A6%E7%BB%86%E6%B5%81%E7%A8%8B%E5%9B%BE%EF%BC%89%201%20%281%29.Stage1%E9%98%B6%E6%AE%B5%20%E8%BF%99%E4%B8%80%E9%98%B6%E6%AE%B5%E5%85%B6%E5%AE%9E%E6%89%A7%E8%A1%8C%E7%9A%84%E5%B0%B1%E6%98%AF%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%97%B6%E9%A2%84%E5%85%88%E5%86%99%E5%85%A5%E5%88%B0MBR%E7%9A%84Bootloader%E7%A8%8B%E5%BA%8F%E3%80%82%20%E5%AE%83%E7%9A%84%E4%BB%BB%E5%8A%A1%E4%BB%85%E6%98%AF%E8%AF%BB%E5%8F%96%EF%BC%88%E5%8A%A0%E8%BD%BD%EF%BC%89%E7%A1%AC%E7%9B%98%E7%9A%840%E6%9F%B1%E9%9D%A2%EF%BC%8C0%E7%A3%81%E9%81%93%EF%BC%8C2%E6%89%87%E5%8C%BA%E7%9A%84%E5%86%85%E5%AE%B9%EF%BC%88%2Fboot%2Fgrub%2Fstage1%EF%BC%89%E5%B9%B6%E6%89%A7%E8%A1%8C%E3%80%82%201%202%20%5Broot%40CentOS6,2018%20%2Fboot%2Fgrub%2Fstage1%20...%202%20%282%29.Stage1.5%E9%98%B6%E6%AE%B5%20%E8%BF%99%E4%B8%80%E9%98%B6%E6%AE%B5%E6%98%AFStage1%E9%98%B6%E6%AE%B5%E5%92%8CStage2%E9%98%B6%E6%AE%B5%E7%9A%84%E6%A1%A5%E6%A2%81%EF%BC%8C%E5%85%B7%E6%9C%89%E8%AF%86%E5%88%AB%E5%88%86%E5%8C%BA%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9A%84%E8%83%BD%E5%8A%9B%EF%BC%8C%E6%AD%A4%E5%90%8Egrub%E7%A8%8B%E5%BA%8F%E4%BE%BF%E6%9C%89%E8%83%BD%E5%8A%9B%E5%8E%BB%E8%AE%BF%E9%97%AE%2Fboot%2Fgrub%2Fstage2%EF%BC%8C%E5%B9%B6%E5%B0%86%E5%85%B6%E8%AF%BB%E5%8F%96%E5%88%B0%E5%86%85%E5%AD%98%E6%89%A7%E8%A1%8C%E3%80%82%203%20%283%29.Stage2%E9%98%B6%E6%AE%B5">https://www.cnblogs.com/diantong/p/10734202.html#:~:text&#x3D;CentOS6%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%EF%BC%88%E5%90%AB%E8%AF%A6%E7%BB%86%E6%B5%81%E7%A8%8B%E5%9B%BE%EF%BC%89%201%20%281%29.Stage1%E9%98%B6%E6%AE%B5%20%E8%BF%99%E4%B8%80%E9%98%B6%E6%AE%B5%E5%85%B6%E5%AE%9E%E6%89%A7%E8%A1%8C%E7%9A%84%E5%B0%B1%E6%98%AF%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%97%B6%E9%A2%84%E5%85%88%E5%86%99%E5%85%A5%E5%88%B0MBR%E7%9A%84Bootloader%E7%A8%8B%E5%BA%8F%E3%80%82%20%E5%AE%83%E7%9A%84%E4%BB%BB%E5%8A%A1%E4%BB%85%E6%98%AF%E8%AF%BB%E5%8F%96%EF%BC%88%E5%8A%A0%E8%BD%BD%EF%BC%89%E7%A1%AC%E7%9B%98%E7%9A%840%E6%9F%B1%E9%9D%A2%EF%BC%8C0%E7%A3%81%E9%81%93%EF%BC%8C2%E6%89%87%E5%8C%BA%E7%9A%84%E5%86%85%E5%AE%B9%EF%BC%88%2Fboot%2Fgrub%2Fstage1%EF%BC%89%E5%B9%B6%E6%89%A7%E8%A1%8C%E3%80%82%201%202%20%5Broot%40CentOS6,2018%20%2Fboot%2Fgrub%2Fstage1%20…%202%20%282%29.Stage1.5%E9%98%B6%E6%AE%B5%20%E8%BF%99%E4%B8%80%E9%98%B6%E6%AE%B5%E6%98%AFStage1%E9%98%B6%E6%AE%B5%E5%92%8CStage2%E9%98%B6%E6%AE%B5%E7%9A%84%E6%A1%A5%E6%A2%81%EF%BC%8C%E5%85%B7%E6%9C%89%E8%AF%86%E5%88%AB%E5%88%86%E5%8C%BA%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9A%84%E8%83%BD%E5%8A%9B%EF%BC%8C%E6%AD%A4%E5%90%8Egrub%E7%A8%8B%E5%BA%8F%E4%BE%BF%E6%9C%89%E8%83%BD%E5%8A%9B%E5%8E%BB%E8%AE%BF%E9%97%AE%2Fboot%2Fgrub%2Fstage2%EF%BC%8C%E5%B9%B6%E5%B0%86%E5%85%B6%E8%AF%BB%E5%8F%96%E5%88%B0%E5%86%85%E5%AD%98%E6%89%A7%E8%A1%8C%E3%80%82%203%20%283%29.Stage2%E9%98%B6%E6%AE%B5</a></p>
<h1 id="CentOS-7"><a href="#CentOS-7" class="headerlink" title="CentOS 7"></a>CentOS 7</h1><div class="note orange icon-padding flat">
<p>上面讲解的内容是基于bios和mbr，目前的话大部分使用UEFT+GPT的方式加载bootloader。CentOS6使用的引导程序为GRUB1，CentOS7使用的引导程序为GRUB2。CentOS6使用的初始化程序为init，CentOS7使用的初始化程序为systemd。</p>
</div>

<h2 id="BIOS和UEFI"><a href="#BIOS和UEFI" class="headerlink" title="BIOS和UEFI"></a>BIOS和UEFI</h2><p>bios是计算机启动固件。bios只认识设备，不认识分区，不认识文件并且运行在16位模式下。UEFI可以认为是bios的升级版，它可以在32位或64位模式下运行。UEFI本质上就是一个运行在PC固件上微型操作系统同时以驱动方式识别设备。不同于BIOS只能识别MBR，UEFI系统默认能识别FAT32。这就意味着只要将引导程序放到FAT32分区里，UEFI系统就能通过分区表的指引找到这个保存着引导程序的FAT32。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Linuxprobe18/article/details/124768818">https://blog.csdn.net/Linuxprobe18/article/details/124768818</a></p>
<p>vmvare如何打开UEFI？</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/5201351/p/12856950.html#:~:text=%E4%BD%BF%E7%94%A8VMware%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%8C%E9%BB%98%E8%AE%A4%E8%BF%98%E6%98%AF%E4%BC%9A%E4%BD%BF%E7%94%A8%E4%BC%A0%E7%BB%9F%E7%9A%84BIOS%E5%9B%BA%E4%BB%B6%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%83%B3%E8%A6%81%E4%BD%BF%E7%94%A8%20EFI,%E5%9B%BA%E4%BB%B6%E9%80%89%E9%A1%B9%E5%BC%95%E5%AF%BC%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%8C%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E5%A6%82%E4%B8%8B%E6%96%B9%E5%BC%8F%EF%BC%8C%201%E3%80%81%E5%85%88%E5%88%9B%E5%BB%BA%E5%A5%BD%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%8C%E5%9C%A8%E5%AE%89%E8%A3%85%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%B9%8B%E5%89%8D%EF%BC%8C">https://www.cnblogs.com/5201351/p/12856950.html#:~:text&#x3D;%E4%BD%BF%E7%94%A8VMware%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%8C%E9%BB%98%E8%AE%A4%E8%BF%98%E6%98%AF%E4%BC%9A%E4%BD%BF%E7%94%A8%E4%BC%A0%E7%BB%9F%E7%9A%84BIOS%E5%9B%BA%E4%BB%B6%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%83%B3%E8%A6%81%E4%BD%BF%E7%94%A8%20EFI,%E5%9B%BA%E4%BB%B6%E9%80%89%E9%A1%B9%E5%BC%95%E5%AF%BC%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%8C%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E5%A6%82%E4%B8%8B%E6%96%B9%E5%BC%8F%EF%BC%8C%201%E3%80%81%E5%85%88%E5%88%9B%E5%BB%BA%E5%A5%BD%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%8C%E5%9C%A8%E5%AE%89%E8%A3%85%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%B9%8B%E5%89%8D%EF%BC%8C</a></p>
<p>fdisk查看分区类型为EFI System，然后该目录下的efi文件为引导文件。<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/u010875635/article/details/74289971">https://blog.csdn.net/u010875635/article/details/74289971</a></p>
<h2 id="grub2"><a href="#grub2" class="headerlink" title="grub2"></a>grub2</h2><p>grub2使用img文件，不再使用grub中的stage1、stage1.5和stage2。grub2的组成如下：</p>
<p>boot.img：这个镜像相当于stage1阶段<br>core.img：这个镜像相当于stage1_5和stage2阶段。core.img的安装位置随MBR磁盘和GPT磁盘而不同，在GPT磁盘中则位于一个独立的分区中。该分区标识为bios。</p>
<p>在UEFI架构中，boot.img和core.img应该合并成了一个即BOOTX64.EFI。</p>
<p>GRUB2介绍：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/f-ck-need-u/p/7094693.html">https://www.cnblogs.com/f-ck-need-u/p/7094693.html</a></p>
<p>CentOS中UEFI中引导文件来源：</p>
<pre><code>[root@192 Packages]# rpm -pql grub2-efi-x64-2.02-0.80.el7.centos.x86_64.rpm
warning: grub2-efi-x64-2.02-0.80.el7.centos.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY
/boot/efi/EFI/centos
/boot/efi/EFI/centos/fonts
/boot/efi/EFI/centos/fonts/unicode.pf2
/boot/efi/EFI/centos/grub.cfg
/boot/efi/EFI/centos/grubenv
/boot/efi/EFI/centos/grubx64.efi
/boot/grub2/grubenv
/etc/grub2-efi.cfg
</code></pre>
<h2 id="systemd"><a href="#systemd" class="headerlink" title="systemd"></a>systemd</h2><p>systemd配置文件和init的差别：</p>
<pre><code>（1）默认的 RunLevel（在/etc/inittab文件设置）现在被默认的 Target 取代，位置是/etc/systemd/system/default.target，通常符号链接到graphical.target（图形界面）或者multi-user.target（多用户命令行）。

（2）启动脚本的位置，以前是/etc/init.d目录，符号链接到不同的 RunLevel 目录 （比如/etc/rc3.d、/etc/rc5.d等），现在则存放在/lib/systemd/system和/etc/systemd/system目录。/etc/systemd/system/都是链接的/lib/systemd/system下的文件。

（3）配置文件的位置，以前init进程的配置文件是/etc/inittab，各种服务的配置文件存放在/etc/sysconfig目录。现在的配置文件主要存放在/lib/systemd目录，在/etc/systemd目录里面的修改可以覆盖原始设置
</code></pre>
<p>CentOS7 的启动过程：</p>
<pre><code>（1）UEFi或BIOS初始化，运行POST开机自检
（2）选择启动设备
（3）引导装载程序, centos7是grub2
（4）加载装载程序的配置文件：/etc/grub.d/ /etc/default/grub /boot/grub2/grub.cfg
（5）加载initramfs驱动模块
（6）加载内核选项
（7）内核初始化，centos7使用systemd代替init
（8）执行initrd.target所有单元，包括挂载/etc/fstab
（9) 从initramfs根文件系统切换到磁盘根目录
(10) systemd执行default.target配置，配置文件/etc/systemd/system/default.target，其实这一个链接到graphical.target的软连接。这阶段层层依赖到 graphical.target–&gt;multi-user.target–&gt;basic.target–&gt;sysinit.target–&gt;/etc/rc.d/rc.local：系统最后启动的一个服务，准确说，应该执行的一个脚本；-fs.target 必须在依赖启动后才能启动
(11)local-fs.target 所有的用户服务都不启动，这阶段只处理核心底层的服务。扮演的是 /etc/fstab 和 /etc/inittab 这样的角色。
（12）sysinit.target 这阶段启动重要的系统服务，像文件系统挂载，swap，设备，内核补充选项
（13）basic.target 这阶段启动普通服务，特别是图形管理服务
（14）multi-user.target 这一阶段启动非root用户进程，防火墙相关的服务也是这时启动的。
（15）systemd启动multi-user.target下的本机与服务器服务
（16）systemd执行multi-user.target下的/etc/rc.d/rc.local
（17）Systemd执行multi-user.target下的getty.target及登录服务，如果不启动graphical则到此为止。
（18）systemd执行graphical需要的服务
</code></pre>
<p>graphical.target文件内容：</p>
<pre><code>[Unit]
Description=Graphical Interface  //简短描述
Documentation=man:systemd.special(7) //文档地址
Requires=multi-user.target  //当前 Unit 依赖的其他 Unit，如果它们没有运行，当前 Unit 会启动失败
Wants=display-manager.service //当前 Unit 配合的其他 Unit，如果它们没有运行，当前 Unit 不会启动失败
Conflicts=rescue.service rescue.target //这里指定的 Unit 不能与当前 Unit 同时运行
After=multi-user.target rescue.service rescue.target display-manager.service   //After表示multi-user.target在basic.target rescue.service rescue.target之后启动，如果有他们的话。显然，如果启动了 rescue.service rescue.target则表示进入rescue状态，则必然无法启动multi-user.target，从而就不可能进入multi-user状态了 
AllowIsolate=yes 允许使用systemctl isolate命令切换到graphical.target
</code></pre>
<p>注：systemd配置文件中的Install区块中的WantedBy，定义如何安装这个配置文件，即怎样做到开机启动。这个设置非常重要，因为执行systemctl enable sshd.service命令时，sshd.service的一个符号链接，就会放在&#x2F;etc&#x2F;systemd&#x2F;system目录下面的multi-user.target.wants子目录之中。</p>
<h2 id="grub2-安装"><a href="#grub2-安装" class="headerlink" title="grub2 安装"></a>grub2 安装</h2><p>grub2-install： grub安装（MBR）</p>
<pre><code>[root@localhost boot]# grub2-install --boot-directory=/media/boot /dev/sdb
Installing for i386-pc platform.
Installation finished. No error reported.
[root@localhost boot]# ll
total 0
drwxr-xr-x. 5 root root 63 Jan 22 06:57 grub2
</code></pre>
<p>grub2-mkconfig 是根据&#x2F;etc&#x2F;default&#x2F;grub文件来创建配置文件的。</p>
<pre><code>[root@localhost boot]# grub2-mkconfig -o /media/boot/grub2/grub.cfg
Generating grub configuration file ...
Found linux image: /boot/vmlinuz-3.10.0-1062.el7.x86_64
Found initrd image: /boot/initramfs-3.10.0-1062.el7.x86_64.img
Found linux image: /boot/vmlinuz-0-rescue-39dfed02eb5d45adaaa54cb1f15f4d83
Found initrd image: /boot/initramfs-0-rescue-39dfed02eb5d45adaaa54cb1f15f4d83.img
done
</code></pre>
<p>注：判断分区是mbr或gpt：<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/a13568hki/article/details/106014313">https://blog.csdn.net/a13568hki/article/details/106014313</a>  </p>
<p>systemd教程：<br><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html">http://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html</a><br><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-part-two.html">https://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-part-two.html</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/me0607040211/article/details/89071222">https://blog.csdn.net/me0607040211/article/details/89071222</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/Anhui_Chen/article/details/106988113">https://blog.csdn.net/Anhui_Chen&#x2F;article&#x2F;details&#x2F;106988113</a>  </p>
<h1 id="Linux其它命令"><a href="#Linux其它命令" class="headerlink" title="Linux其它命令"></a>Linux其它命令</h1><p>Linux核心：&#x2F;boot&#x2F;vmlinuz-version</p>
<pre><code>/boot/vmlinuz-3.10.0-1062.el7.x86_64
</code></pre>
<p>Linux内核模块位置（ko）: &#x2F;lib&#x2F;modules&#x2F;version&#x2F;</p>
<pre><code>/lib/modules/3.10.0-1062.el7.x86_64
</code></pre>
<p>ldd &#x2F;PATH&#x2F;TO&#x2F;BINARY_FILE：显示二进制文件所依赖的共享库<br>chroot: chroot &#x2F;PATH&#x2F;TO&#x2F;TEMPROOT [COMMAND…]：切换根目录</p>
<pre><code>chroot /test/virrrot  /bin/bash

切换根目录使用过程详解：
[root@localhost ~]# mkdir virroot
[root@localhost ~]# mkdir ./virroot/bin
[root@localhost ~]# cp -p /bin/bash ./virroot/bin/
    
\\ 直接执行会报错
[root@localhost ~]# chroot ./virroot/ /bin/bash
chroot: failed to run command ‘/bin/bash’: No such file or directory
    
\\ 查看bash的依赖
[root@localhost ~]# ldd /bin/bash
linux-vdso.so.1 =&gt;  (0x00007fff48190000)   
libtinfo.so.5 =&gt; /lib64/libtinfo.so.5 (0x00007f8eb4de8000)
libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007f8eb4be4000)
libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f8eb4816000)
/lib64/ld-linux-x86-64.so.2 (0x00007f8eb5012000)

\\ 拷贝相关依赖文件
[root@localhost ~]# cp /lib64/libtinfo.so.5 virroot/lib64/
[root@localhost ~]# cp /lib64/libdl.so.2 virroot/lib64/
[root@localhost ~]# cp /lib64/libc.so.6 virroot/lib64/
[root@localhost ~]# cp /lib64/ld-linux-x86-64.so.2 virroot/lib64/

\\ 切换根目录，目前这个bash中只能执行自带的命令
[root@localhost ~]# chroot virroot/ /bin/bash
bash-4.2# 
</code></pre>
<p>用户空间访问、监控内核的方式：</p>
<pre><code>伪文件系统
    
    /proc/sys: 此目录中的文件很多是可读写的
    /sys/： 某些文件可写


设定内核参数值的方法：
    echo VALUE &gt; /proc/sys/TO/SOMEFILE
    sysctl -w kernel.hostname=
    
    能立即生效，但无法永久有效；

永久有效：/etc/sysctl.conf
    文件内容添加如下：
         kernel.hostname=demo1

    修改文件完成之后，执行如下命令可立即生效：
    sysctl -p	

sysctl -a: 显示所有内核参数及其值
</code></pre>
<p>内核模块管理：</p>
<p>lsmod: 查看模块</p>
<pre><code>[root@localhost sys]# lsmod|head -5
Module                  Size  Used by
binfmt_misc            17468  1 
tcp_lp                 12663  0 
nls_utf8               12557  1 
isofs                  39844  1 
</code></pre>
<p>modprobe MOD_NAME：装载某模块<br>modprobe -r MOD_NAME: 卸载某模块<br>modinfo MOD_NAME: 查看模块的具体信息  </p>
<pre><code>[root@localhost sys]# modinfo tcp_lp
filename:       /lib/modules/3.10.0-1062.el7.x86_64/kernel/net/ipv4/tcp_lp.ko.xz
description:    TCP Low Priority
license:        GPL
author:         Wong Hoi Sing Edison, Hung Hing Lun Mike
retpoline:      Y
rhelversion:    7.7
srcversion:     8AECB32F50124FF15710FCC
depends:        
intree:         Y
vermagic:       3.10.0-1062.el7.x86_64 SMP mod_unload modversions 
signer:         CentOS Linux kernel signing key
sig_key:        51:08:4E:41:88:03:02:BE:5C:B0:74:AC:0D:A3:FE:10:23:3B:7F:1C
sig_hashalgo:   sha256
注：CentOS7 最新版本内核从&quot;kernel.ko&quot;移至&quot;kernel.ko.xz”。
</code></pre>
<p>insmod &#x2F;PATH&#x2F;TO&#x2F;MODULE_FILE: 装载模块	<br>rmmod MOD_NAME：卸载模块</p>
<p>depmod &#x2F;PATH&#x2F;TO&#x2F;MODILES_DIR:生成模块之间的依赖关系</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/hanxiaomeng/p/12728104.html">https://www.cnblogs.com/hanxiaomeng/p/12728104.html</a></p>
<h1 id="Linux内核编译-多内核"><a href="#Linux内核编译-多内核" class="headerlink" title="Linux内核编译(多内核)"></a>Linux内核编译(多内核)</h1><p>我使用的CentOS7的内核版本是3.10.0，虚拟机软件为VMware® Workstation 16 Pro。内核版本相差太大会可能会导致不兼容。先从<a target="_blank" rel="noopener" href="https://mirrors.edge.kernel.org/">https://mirrors.edge.kernel.org/</a> 上下载内核，然后上传到Linux系统中。  </p>
<ol>
<li><p>准备编译环境</p>
<pre><code> yum group install &quot;Development Tools&quot;  --setopt=group_package_types=mandatory,default,optional
</code></pre>
</li>
<li><p>Linux内核源码目录在：&#x2F;usr&#x2F;src&#x2F;kernels。首先，将Linux内核解压到&#x2F;usr&#x2F;src&#x2F;kernels下</p>
<pre><code> [root@demo1 src]# tar -zxvf /home/demo/Desktop/linux-3.13.10.tar.gz  -C /usr/src/kernels
</code></pre>
</li>
<li><p>将当前正在使用或编译的内核链接为linux目录</p>
<pre><code> [root@demo1 kernels]# ln -s linux-3.13.10/ linux
</code></pre>
</li>
<li><p>编译</p>
</li>
</ol>
<p>内核中的功能除了核心功能之外，在编译时，大多功能都有三种选择：</p>
<pre><code>1、不使用此功能；
2、编译成内核模块；
3、编译进内核；
</code></pre>
<p>如何指定编译内核的功能：</p>
<pre><code>  make gconfig: Gnome桌面环境使用，需要安装图形开发库组：GNOME Software Development
  make kconfig: KDE桌面环境使用，需要安装图形开发库
  make menuconfig: 文本界面，在内核目录下执行（最常用）
</code></pre>
<p>在&#x2F;usr&#x2F;src&#x2F;linux&#x2F;kernels目录下执行make menuconfig</p>
<pre><code>     .config - Linux/x86 3.13.10 Kernel Configuration

      ┌──────────────────────────────────────── Linux/x86 3.13.10 Kernel Configuration ────────────────────────────────────────┐
      │  Arrow keys navigate the menu.  &lt;Enter&gt; selects submenus ---&gt; (or empty submenus ----).  Highlighted letters are       │  
      │  hotkeys.  Pressing &lt;Y&gt; includes, &lt;N&gt; excludes, &lt;M&gt; modularizes features.  Press &lt;Esc&gt;&lt;Esc&gt; to exit, &lt;?&gt; for Help, &lt;/&gt; │  
      │  for Search.  Legend: [*] built-in  [ ] excluded  &lt;M&gt; module  &lt; &gt; module capable                                       │  
      │                                                                                                                        │  
      │ ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │  
      │ │                       [*] 64-bit kernel                                                                            │ │  
      │ │                           General setup  ---&gt;                                                                      │ │  
      │ │                       -*- Provide system-wide ring of trusted keys                                                 │ │  
      │ │                       [*] Enable loadable module support  ---&gt;                                                     │ │  
      │ │                       -*- Enable the block layer  ---&gt;                                                             │ │  
      │ │                           Processor type and features  ---&gt;                                                        │ │  
      │ │                           Power management and ACPI options  ---&gt;                                                  │ │  
      │ │                           Bus options (PCI etc.)  ---&gt;                                                             │ │  
      │ │                           Executable file formats / Emulations  ---&gt;                                               │ │  
      │ │                       -*- Networking support  ---&gt;                                                                 │ │  
      │ │                           Device Drivers  ---&gt;                                                                     │ │  
      │ │                           Firmware Drivers  ---&gt;                                                                   │ │  
      │ │                           File systems  ---&gt;                                                                       │ │  
      │ └───────────────────────↓(+)─────────────────────────────────────────────────────────────────────────────────────────┘ │  
             
      │                                &lt;Select&gt;    &lt; Exit &gt;    &lt; Help &gt;    &lt; Save &gt;    &lt; Load &gt;                                │  
      
      注：---&gt;代表有子选项
         * 代表编译进内核
         M 代表编译成模块 
         空格键可以进行切换

         General setup-&gt;Local version - append to kernel release 代表本地版本号
         Processor type and features：代表处理器的类型
         File systems：代表文件系统
         Networking support：代表网络
         两次ESC键返回上一层

在编译特性时，会将结果保存到.config文件中。我们可以将CentOS系统/boot/config-3.10.0-1062.el7.x86_64拷贝到/usr/src/linux/.config，然后在它的基础上改。/boot/config-3.10.0-1062.el7.x86_64为红帽在编译当前系统内核时指定的特性文件。
</code></pre>
<p>在&#x2F;usr&#x2F;src&#x2F;linux&#x2F;kernels目录下执行make</p>
<pre><code>  CC      sound/usb/hiface/snd-usb-hiface.mod.o
  LD [M]  sound/usb/hiface/snd-usb-hiface.ko
  CC      sound/usb/misc/snd-ua101.mod.o
  LD [M]  sound/usb/misc/snd-ua101.ko
  CC      sound/usb/snd-usb-audio.mod.o
  LD [M]  sound/usb/snd-usb-audio.ko
  CC      sound/usb/snd-usbmidi-lib.mod.o
  LD [M]  sound/usb/snd-usbmidi-lib.ko
  CC      sound/usb/usx2y/snd-usb-us122l.mod.o
</code></pre>
<p>在&#x2F;usr&#x2F;src&#x2F;linux&#x2F;kernels目录下执行make modules_install </p>
<pre><code>  INSTALL /lib/firmware/kaweth/trigger_code_fix.bin
  INSTALL /lib/firmware/ti_3410.fw
  INSTALL /lib/firmware/ti_5052.fw
  INSTALL /lib/firmware/mts_cdma.fw
  INSTALL /lib/firmware/mts_gsm.fw
  INSTALL /lib/firmware/mts_edge.fw
  INSTALL /lib/firmware/edgeport/boot.fw
  INSTALL /lib/firmware/edgeport/boot2.fw
  INSTALL /lib/firmware/edgeport/down.fw
  INSTALL /lib/firmware/edgeport/down2.fw
  INSTALL /lib/firmware/edgeport/down3.bin
  INSTALL /lib/firmware/whiteheat_loader.fw
  INSTALL /lib/firmware/whiteheat.fw
  INSTALL /lib/firmware/keyspan_pda/keyspan_pda.fw
  INSTALL /lib/firmware/keyspan_pda/xircom_pgs.fw
  DEPMOD  3.10.30
</code></pre>
<p>在&#x2F;usr&#x2F;src&#x2F;linux&#x2F;kernels目录下执行make install </p>
<pre><code>[root@localhost linux]# make install
sh /usr/src/kernels/linux-3.10.30/arch/x86/boot/install.sh 3.10.30 arch/x86/boot/bzImage \
    System.map &quot;/boot&quot;
</code></pre>
<p>注：我编译的Linux-4.1.16内核成功，但是编译3.X版本的内核会遇到depmod错误或者编译成功之后打开报此客户端禁用CPU错误。</p>
<p>遇到问题：<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_38015368/article/details/82120887">https://blog.csdn.net/m0_38015368&#x2F;article&#x2F;details&#x2F;82120887</a><br><a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/1310043">https://access.redhat.com/solutions/1310043</a>  </p>
<p>相关步骤：<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/linetwork/p/13153038.html">https://www.cnblogs.com/linetwork/p/13153038.html</a></p>
<h1 id="Screen命令"><a href="#Screen命令" class="headerlink" title="Screen命令"></a>Screen命令</h1><p>一般情况下我们使用远程连接Linux主机。如果某个操作或进程需要执行很长时间，这时连接中断或关闭远程连接会造成该远程连接下的所有进程都终止。为了避免以上问题我们可以使用screen命令。</p>
<p>首先，需要安装相关程序</p>
<pre><code>[root@demo1 mnt]# yum install screen
</code></pre>
<p>直接打开一个新的屏幕 </p>
<pre><code>[root@demo1 mnt]# screen
</code></pre>
<p>在新窗口中执行操作：</p>
<pre><code>[root@demo1 mnt]# ls -l /
total 26
lrwxrwxrwx.   1 root root    7 Oct 31 13:21 bin -&gt; usr/bin
dr-xr-xr-x.   5 root root 4096 Jan 26 10:11 boot
drwxr-xr-x.  20 root root 3360 Feb  6 01:48 dev
drwxr-xr-x. 141 root root 8192 Feb  6 02:00 etc
drwxr-xr-x.   3 root root   18 Oct 31 13:56 home
lrwxrwxrwx.   1 root root    7 Oct 31 13:21 lib -&gt; usr/lib
lrwxrwxrwx.   1 root root    9 Oct 31 13:21 lib64 -&gt; usr/lib64
drwxr-xr-x.   3 root root   18 Jan 22 07:26 media
drwxr-xr-x.   8 demo demo 2048 Sep 11  2019 mnt
drwxr-xr-x.   3 root root   16 Oct 31 13:39 opt
dr-xr-xr-x. 233 root root    0 Feb  6 01:48 proc
dr-xr-x---.  16 root root 4096 Feb  6 01:51 root
drwxr-xr-x.  44 root root 1340 Feb  6 02:01 run
lrwxrwxrwx.   1 root root    8 Oct 31 13:21 sbin -&gt; usr/sbin
drwxr-xr-x.   2 root root    6 Apr 11  2018 srv
dr-xr-xr-x.  13 root root    0 Feb  6 01:48 sys
drwxrwxrwt.  16 root root 4096 Feb  6 02:14 tmp
drwxr-xr-x.  13 root root  155 Oct 31 13:21 usr
drwxr-xr-x.  20 root root  282 Oct 31 13:53 var
</code></pre>
<p>拆除屏幕（即返回开启screen前的窗口）</p>
<pre><code>Ctrl+a, d: 拆除屏幕，显示如下
[detached from 3470.pts-0.demo1]
</code></pre>
<p>显示已经建立的屏幕</p>
<pre><code>[root@demo1 mnt]# screen -ls
There is a screen on:
    3470.pts-0.demo1	(Detached)
1 Socket in /var/run/screen/S-root.
</code></pre>
<p>还原回某屏幕</p>
<pre><code>[root@demo1 mnt]# screen -r 3470

[root@demo1 mnt]# ls -l /
total 26
lrwxrwxrwx.   1 root root    7 Oct 31 13:21 bin -&gt; usr/bin
dr-xr-xr-x.   5 root root 4096 Jan 26 10:11 boot
drwxr-xr-x.  20 root root 3360 Feb  6 01:48 dev
drwxr-xr-x. 141 root root 8192 Feb  6 02:00 etc
drwxr-xr-x.   3 root root   18 Oct 31 13:56 home
lrwxrwxrwx.   1 root root    7 Oct 31 13:21 lib -&gt; usr/lib
lrwxrwxrwx.   1 root root    9 Oct 31 13:21 lib64 -&gt; usr/lib64
drwxr-xr-x.   3 root root   18 Jan 22 07:26 media
drwxr-xr-x.   8 demo demo 2048 Sep 11  2019 mnt
drwxr-xr-x.   3 root root   16 Oct 31 13:39 opt
dr-xr-xr-x. 233 root root    0 Feb  6 01:48 proc
dr-xr-x---.  16 root root 4096 Feb  6 01:51 root
drwxr-xr-x.  44 root root 1340 Feb  6 02:01 run
lrwxrwxrwx.   1 root root    8 Oct 31 13:21 sbin -&gt; usr/sbin
drwxr-xr-x.   2 root root    6 Apr 11  2018 srv
dr-xr-xr-x.  13 root root    0 Feb  6 01:48 sys
drwxrwxrwt.  16 root root 4096 Feb  6 02:14 tmp
drwxr-xr-x.  13 root root  155 Oct 31 13:21 usr
drwxr-xr-x.  20 root root  282 Oct 31 13:53 var
</code></pre>
<p>退出该屏幕（exit）</p>
<pre><code>[root@demo1 mnt]# exit
</code></pre>
<h1 id="Linux制作启动硬盘（我以CentOS7制作该内容失败了，只供参考）"><a href="#Linux制作启动硬盘（我以CentOS7制作该内容失败了，只供参考）" class="headerlink" title="Linux制作启动硬盘（我以CentOS7制作该内容失败了，只供参考）"></a>Linux制作启动硬盘（我以CentOS7制作该内容失败了，只供参考）</h1><p>操作顺序如下：grub–&gt;kernel–&gt;initrd–&gt;ROOTFS(&#x2F;sbin&#x2F;init, &#x2F;bin&#x2F;bash)</p>
<p>第一步添加一个新的硬盘<br>第二步使用fdisk命令在新的硬盘中新建两个分区（第一个）  </p>
<pre><code>Disk /dev/sdb: 2147 MB, 2147483648 bytes, 4194304 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0xac7fe85b

   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1   *        2048      411647      204800   83  Linux
/dev/sdb2          411648     1026047      307200   83  Linux
注：a选项给分区增加boot标识
</code></pre>
<p>第三步使用mkfs命令为两个分区建立文件系统（文件系统类型随意）</p>
<pre><code>/dev/sda1: UUID=&quot;63389af9-2128-4b68-b072-0b3d7aaca50d&quot; TYPE=&quot;xfs&quot; 
/dev/sdb2: UUID=&quot;8e4ec16f-7a85-4c68-957d-4008a24539b0&quot; SEC_TYPE=&quot;ext2&quot; TYPE=&quot;ext3&quot; 
</code></pre>
<p>第四步在media下新建两个目录</p>
<pre><code>[root@demo1 media]# ls
sysboot  sysroot
</code></pre>
<p>第五步将分区进行相应挂载</p>
<pre><code>[root@demo1 media]# mount /dev/sdb1 /media/sysboot/
[root@demo1 media]# mount /dev/sdb2 /media/sysroot/
</code></pre>
<p>第六步将boot分区下的内核拷贝到新建的boot分区下</p>
<pre><code>[root@demo1 sysboot]# cp /boot/vmlinuz-3.10.0-1062.el7.x86_64 /media/sysboot/
</code></pre>
<p>第七步新建grub引导文件(CentOS7)</p>
<pre><code>\\ 生成grub2文件
[root@demo1 sysboot]# grub2-install --boot-directory=/media/sysboot /dev/sdb
Installing for i386-pc platform.
Installation finished. No error reported.

[root@demo1 sysboot]# ll
total 6580
drwxr-xr-x. 5 root root      63 Feb  6 02:52 grub2

\\ 生成grub.cfg配置文件
[root@demo1 sysboot]# grub2-mkconfig -o /media/sysboot/grub2/grub.cfg
Generating grub configuration file ...
Found linux image: /boot/vmlinuz-3.10.301.0-el
Found initrd image: /boot/initramfs-3.10.301.0-el.img
Found linux image: /boot/vmlinuz-3.10.0-1062.el7.x86_64
Found initrd image: /boot/initramfs-3.10.0-1062.el7.x86_64.img
Found linux image: /boot/vmlinuz-0-rescue-39dfed02eb5d45adaaa54cb1f15f4d83
Found initrd image: /boot/initramfs-0-rescue-39dfed02eb5d45adaaa54cb1f15f4d83.img
done

[root@demo1 grub2]# ll
total 28
drwxr-xr-x. 2 root root   25 Feb  6 02:52 fonts
-rw-r--r--. 1 root root 5235 Feb  6 02:56 grub.cfg
-rw-r--r--. 1 root root 1024 Feb  6 02:52 grubenv
drwxr-xr-x. 2 root root 8192 Feb  6 02:52 i386-pc
drwxr-xr-x. 2 root root 4096 Feb  6 02:52 locale
</code></pre>
<p>第八步新建的grub.cfg引导文件是以&#x2F;boot目录为参考的，需要进行相应修改</p>
<pre><code>删除不需要的menuentry部分

修改某menuentry部分的文件系统id，查看文件系统id命令blkid。

[root@demo1 grub2]# blkid
/dev/sdb1: UUID=&quot;5c7cb977-7c65-45e6-9454-f4cfc0af28ba&quot; TYPE=&quot;xfs&quot; 
/dev/sda1: UUID=&quot;63389af9-2128-4b68-b072-0b3d7aaca50d&quot; TYPE=&quot;xfs&quot; 
/dev/sda2: UUID=&quot;UN0Ex0-C5Bz-oeCn-RbEP-RR1a-x79t-Ikyjh3&quot; TYPE=&quot;LVM2_member&quot; 
/dev/sdb2: UUID=&quot;8e4ec16f-7a85-4c68-957d-4008a24539b0&quot; TYPE=&quot;ext3&quot; 
/dev/sr0: UUID=&quot;2019-09-11-18-50-31-00&quot; LABEL=&quot;CentOS 7 x86_64&quot; TYPE=&quot;iso9660&quot; PTTYPE=&quot;dos&quot; 
/dev/mapper/centos-root: UUID=&quot;827a53b1-31be-4ab8-b5a2-3310ee209a81&quot; TYPE=&quot;xfs&quot; 
/dev/mapper/centos-swap: UUID=&quot;f03a485d-b51a-4f0a-ad29-1262c359686f&quot; TYPE=&quot;swap&quot; 

修改linux16中的根目录root所在分区，并删除rd.lvm.lv=centos/root rd.lvm.lv=centos/swap rhgb quiet。

在linux16命令结尾处添加init=/bin/bash

修改后的结果如下：
menuentry &#39;CentOS Linux (3.10.0-1062.el7.x86_64) 7 (Core)&#39; --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option &#39;gnulinux-3.10.0-1062.el7.x86_64-advanced-827a53b1-31be-4ab8-b5a2-3310ee209a81&#39; &#123;
        load_video
        set gfxpayload=keep
        insmod gzio
        insmod part_msdos
        insmod xfs
        set root=&#39;hd0,msdos1&#39;
        if [ x$feature_platform_search_hint = xy ]; then
          search --no-floppy --fs-uuid --set=root --hint-bios=hd0,msdos1 --hint-efi=hd0,msdos1 --hint-baremetal=ahci0,msdos1 --hint=&#39;hd0,msdos1&#39;  d6eb1eec-e0c1-4287-893e-83520d5448c7（修改为boot分区的id）
        else
          search --no-floppy --fs-uuid --set=root d6eb1eec-e0c1-4287-893e-83520d5448c7（修改为boot分区的id）
        fi
        linux16 /vmlinuz-3.10.0-1062.el7.x86_64 root=/dev/sda2(修改根目录分区) ro crashkernel=auto init=/bin/bash
        initrd16 /initramfs-3.10.0-1062.el7.x86_64.img
&#125;
</code></pre>
<p>第九步建立虚拟文件系统</p>
<pre><code>mkinitrd  initrd文件路径  内核版本号

[root@demo1 grub2]# mkinitrd /media/sysboot/initramfs-`uname -r`.img `uname -r`

[root@demo1 sysboot]# file initramfs-3.10.0-1062.el7.x86_64.img 
initramfs-3.10.0-1062.el7.x86_64.img: ASCII cpio archive (SVR4 with no CRC)
</code></pre>
<p>第十步修改虚拟文件系统：</p>
<pre><code>CentOS 5解压虚拟文件：
    CentOS 5 的initrd-*是.gz压缩文件。需要先加后缀，再解压。然后使用cpio -id &lt; initrd-2.16.18-308.el5.img提取文件。

    或者只使用zcat /boot/initrd-2.16.18-308.el5.img|cpio -id
    
    然后修改虚拟文件系统中的init文件中的mkrootdev后面的根目录（CenOS7在grub.cfg中修改）
    
    最后使用find . |cpio -H newc --quiet-o|gzip -9 /mnt/boot/initrd.gz重新打包虚拟文件系统
 
CentOS 7解压虚拟文件系统

    解压： /usr/lib/dracut/skipcpio ../initramfs-3.10.0-1062.el7.x86_64.img|zcat |cpio -id
    打包：find . |cpio -o -H newc | gzip &gt; initramfs_cpio.img

    注：由于根目录是ext3，所以将相关模块拷贝到虚拟文件系统中
    [root@demo1 fs]# lsmod |grep ext
    ext4                  584153  1 
    mbcache                14958  1 ext4
    jbd2                  107478  1 ext4

    \\加载相关模块
    [root@demo1 fs]# cp -r /usr/lib/modules/3.10.0-1062.el7.x86_64/kernel/fs/ext4/ /media/sysboot/demo/usr/lib/modules/3.10.0-1062.el7.x86_64/kernel/fs
    [root@demo1 fs]# cp -r /usr/lib/modules/3.10.0-1062.el7.x86_64/kernel/fs/jbd2/ /media/sysboot/demo/usr/lib/modules/3.10.0-1062.el7.x86_64/kernel/fs
    [root@demo1 fs]# cp -r /usr/lib/modules/3.10.0-1062.el7.x86_64/kernel/fs/mbcache.ko.xz /media/sysboot/demo/usr/lib/modules/3.10.0-1062.el7.x86_64/kernel/fs
    
    [root@demo1 demo]# cp /sbin/depmod /media/sysboot/demo/sbin/
    [root@demo1 demo]# ldd /sbin/depmod 
        linux-vdso.so.1 =&gt;  (0x00007ffee1183000)
        liblzma.so.5 =&gt; /lib64/liblzma.so.5 (0x00007fe38dee1000)
        libz.so.1 =&gt; /lib64/libz.so.1 (0x00007fe38dccb000)
        libgcc_s.so.1 =&gt; /lib64/libgcc_s.so.1 (0x00007fe38dab5000)
        libc.so.6 =&gt; /lib64/libc.so.6 (0x00007fe38d6e7000)
        libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007fe38d4cb000)
        /lib64/ld-linux-x86-64.so.2 (0x00007fe38e107000)
    [root@demo1 demo]# cp /lib64/liblzma.so.5 /lib64/libz.so.1 /lib64/libgcc_s.so.1 /lib64/libc.so.6 /lib64/libpthread.so.0 /lib64/ld-linux-x86-64.so.2 /media/sysboot/demo/lib64

    [root@demo1 fs]# cd /media/sysboot/demo/
    [root@demo1 demo]# chroot .
    
    \\重建模块依赖
    bash-4.2# depmod
</code></pre>
<p>第十一步创建根文件系统：</p>
<pre><code>   在第二个分区按照当前系统根目录创建跟文件系统目录
   然后从当前系统拷贝相关命令到自己创建的跟文件系统中，相关命令：ldd、chroot。 
</code></pre>
<p>第十二步将以上硬盘加入到虚拟机中运行：</p>
<h1 id="脚本制作"><a href="#脚本制作" class="headerlink" title="脚本制作"></a>脚本制作</h1><p>前提：</p>
<pre><code>$&#123;parameter#*word&#125;
$&#123;parameter##*word&#125;
$&#123;parameter%word*&#125;
$&#123;parameter%%word*&#125;

FILE=/usr/local/src
$&#123;FILE#*/&#125;: usr/local/src
$&#123;FILE##*/&#125;: src
$&#123;FILE%/*&#125;: /usr/local
$&#123;FILE%%/*&#125;:
</code></pre>
<p>参见博客：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/alongdidi/p/bash_parameter_expansion.html">https://www.cnblogs.com/alongdidi/p/bash_parameter_expansion.html</a></p>
<p>复制二进制程序及其依赖的库文件的脚本：</p>
<pre><code>#!/bin/bash
#
DEST=/mnt/sysroot
libcp() &#123;
  LIBPATH=$&#123;1%/*&#125;
  [ ! -d $DEST$LIBPATH ] &amp;&amp; mkdir -p $DEST$LIBPATH
  [ ! -e $DEST$&#123;1&#125; ] &amp;&amp; cp $1 $DEST$LIBPATH &amp;&amp; echo &quot;copy lib $1 finished.&quot;
&#125;

bincp() &#123;
  CMDPATH=$&#123;1%/*&#125;
  [ ! -d $DEST$CMDPATH ] &amp;&amp; mkdir -p $DEST$CMDPATH
  [ ! -e $DEST$&#123;1&#125; ] &amp;&amp; cp $1 $DEST$CMDPATH

  for LIB in  `ldd $1 | grep -o &quot;/.*lib\(64\)\&#123;0,1\&#125;/[^[:space:]]\&#123;1,\&#125;&quot;`; do
    libcp $LIB
  done
&#125;

read -p &quot;Your command: &quot; CMD
until [ $CMD == &#39;q&#39; ]; do
   ! which $CMD &amp;&gt; /dev/null &amp;&amp; echo &quot;Wrong command&quot; &amp;&amp; read -p &quot;Input again:&quot; CMD &amp;&amp; continue
  COMMAND=` which $CMD | grep -v &quot;^alias&quot; | grep -o &quot;[^[:space:]]\&#123;1,\&#125;&quot;`
  bincp $COMMAND
  echo &quot;copy $COMMAND finished.&quot;
  read -p &quot;Continue: &quot; CMD
done
</code></pre>
<p>注：mount -n: 挂载时不更新&#x2F;etc&#x2F;mtab文件;</p>
<p>相关博客：<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_34245169/article/details/91798455">https://blog.csdn.net/weixin_34245169&#x2F;article&#x2F;details&#x2F;91798455</a><br><a target="_blank" rel="noopener" href="https://linux.cn/article-8807-1.html">https://linux.cn/article-8807-1.html</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhangchaocoming/p/14792181.html">https://www.cnblogs.com/zhangchaocoming/p/14792181.html</a><br><a target="_blank" rel="noopener" href="https://blog.51cto.com/u_14322729/2412355">https://blog.51cto.com/u_14322729&#x2F;2412355</a></p>
<h2 id="内核部分编译"><a href="#内核部分编译" class="headerlink" title="内核部分编译"></a>内核部分编译</h2><p>如何实现部分编译：  </p>
<p>1、只编译某子目录下的相关代码：  </p>
<pre><code>make dir/

make arch/
make drivers/net/
</code></pre>
<p>2、只编译部分模块</p>
<pre><code>make M=drivers/net/
</code></pre>
<p>3、只编译某一模块</p>
<pre><code>make drivers/net/pcnet32.ko
</code></pre>
<p>4、将编译完成的结果放置于别的目录中</p>
<pre><code>make O=/tmp/kernel 
</code></pre>
<p>5、交叉编译（即在一个CPU平台编译其它CPU平台上的代码）</p>
<pre><code>make ARCH=
</code></pre>
<h1 id="Linux系统故障排除"><a href="#Linux系统故障排除" class="headerlink" title="Linux系统故障排除"></a>Linux系统故障排除</h1><h2 id="解决问题思路"><a href="#解决问题思路" class="headerlink" title="解决问题思路"></a>解决问题思路</h2><ul>
<li>确定问题的故障特征</li>
<li>重现故障</li>
<li>使用工具手机进一步信息</li>
<li>排除不可能的原因</li>
<li>定位故障</li>
<li>从简单的问题入手</li>
<li>一次尝试一种方式</li>
<li>备份原文件</li>
<li>尽可能借助于工具</li>
<li></li>
</ul>
<h2 id="可能会出现的故障"><a href="#可能会出现的故障" class="headerlink" title="可能会出现的故障"></a>可能会出现的故障</h2><p>1、用户无法登陆系统（migetty，bash程序故障）</p>
<pre><code>安装系统光盘，进入救援模式下。然后找到安装包执行rpm -ivh --replacepkgs --root /path/to/root bash-3.2-32.el5-i386.rpm
</code></pre>
<p>其它故障：<a target="_blank" rel="noopener" href="https://blog.51cto.com/yuanye1128/1403549?source=drt">https://blog.51cto.com/yuanye1128/1403549?source=drt</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">QiYan</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2022/11/29/Linux-start/">http://example.com/2022/11/29/Linux-start/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">知与行</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/12/04/MySQL/"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">MySQL系列</div></div></a></div><div class="next-post pull-right"><a href="/2022/11/27/Linux-crond/"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Linux计划任务和日志</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">QiYan</div><div class="author-info__description">学而不思则惘 思而不学则殆</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">19</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content"></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#CentOS-6"><span class="toc-number">1.</span> <span class="toc-text">CentOS 6</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B"><span class="toc-number">1.1.</span> <span class="toc-text">启动流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#grub%E5%AE%89%E8%A3%85"><span class="toc-number">1.2.</span> <span class="toc-text">grub安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kernel%E5%88%9D%E5%A7%8B%E5%8C%96%E7%9A%84%E8%BF%87%E7%A8%8B"><span class="toc-number">1.3.</span> <span class="toc-text">Kernel初始化的过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sysvinit"><span class="toc-number">1.4.</span> <span class="toc-text">sysvinit</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CentOS-7"><span class="toc-number">2.</span> <span class="toc-text">CentOS 7</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#BIOS%E5%92%8CUEFI"><span class="toc-number">2.1.</span> <span class="toc-text">BIOS和UEFI</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#grub2"><span class="toc-number">2.2.</span> <span class="toc-text">grub2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#systemd"><span class="toc-number">2.3.</span> <span class="toc-text">systemd</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#grub2-%E5%AE%89%E8%A3%85"><span class="toc-number">2.4.</span> <span class="toc-text">grub2 安装</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Linux%E5%85%B6%E5%AE%83%E5%91%BD%E4%BB%A4"><span class="toc-number">3.</span> <span class="toc-text">Linux其它命令</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Linux%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91-%E5%A4%9A%E5%86%85%E6%A0%B8"><span class="toc-number">4.</span> <span class="toc-text">Linux内核编译(多内核)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Screen%E5%91%BD%E4%BB%A4"><span class="toc-number">5.</span> <span class="toc-text">Screen命令</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Linux%E5%88%B6%E4%BD%9C%E5%90%AF%E5%8A%A8%E7%A1%AC%E7%9B%98%EF%BC%88%E6%88%91%E4%BB%A5CentOS7%E5%88%B6%E4%BD%9C%E8%AF%A5%E5%86%85%E5%AE%B9%E5%A4%B1%E8%B4%A5%E4%BA%86%EF%BC%8C%E5%8F%AA%E4%BE%9B%E5%8F%82%E8%80%83%EF%BC%89"><span class="toc-number">6.</span> <span class="toc-text">Linux制作启动硬盘（我以CentOS7制作该内容失败了，只供参考）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%84%9A%E6%9C%AC%E5%88%B6%E4%BD%9C"><span class="toc-number">7.</span> <span class="toc-text">脚本制作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E6%A0%B8%E9%83%A8%E5%88%86%E7%BC%96%E8%AF%91"><span class="toc-number">7.1.</span> <span class="toc-text">内核部分编译</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Linux%E7%B3%BB%E7%BB%9F%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4"><span class="toc-number">8.</span> <span class="toc-text">Linux系统故障排除</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98%E6%80%9D%E8%B7%AF"><span class="toc-number">8.1.</span> <span class="toc-text">解决问题思路</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E8%83%BD%E4%BC%9A%E5%87%BA%E7%8E%B0%E7%9A%84%E6%95%85%E9%9A%9C"><span class="toc-number">8.2.</span> <span class="toc-text">可能会出现的故障</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/12/15/Docker3/" title="docker数据卷和网络">docker数据卷和网络</a><time datetime="2022-12-15T12:16:17.374Z" title="发表于 2022-12-15 20:16:17">2022-12-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/12/15/Docker1/" title="docker镜像和容器管理">docker镜像和容器管理</a><time datetime="2022-12-15T11:58:22.832Z" title="发表于 2022-12-15 19:58:22">2022-12-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/12/15/Docker2/" title="docker镜像制作">docker镜像制作</a><time datetime="2022-12-15T11:56:40.452Z" title="发表于 2022-12-15 19:56:40">2022-12-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/12/12/Docker/" title="docker基础">docker基础</a><time datetime="2022-12-12T14:37:54.050Z" title="发表于 2022-12-12 22:37:54">2022-12-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/12/04/Linux%E9%9B%86%E7%BE%A4%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" title="Linux集群基础概念">Linux集群基础概念</a><time datetime="2022-12-04T11:14:41.278Z" title="发表于 2022-12-04 19:14:41">2022-12-04</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By QiYan</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>